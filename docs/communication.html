<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Communication é€šä¿¡æ¨¡å— - è”é‚¦å­¦ä¹ æ¡†æ¶æ–‡æ¡£</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>ğŸš€ è”é‚¦å­¦ä¹ æ¡†æ¶</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                <li><a href="core.html" class="nav-link">Core</a></li>
                <li><a href="aggregation.html" class="nav-link">Aggregation</a></li>
                <li><a href="data.html" class="nav-link">Data</a></li>
                <li><a href="models.html" class="nav-link">Models</a></li>
                <li><a href="utils.html" class="nav-link">Utils</a></li>
                <li><a href="execution-flow.html" class="nav-link">æ‰§è¡Œæµç¨‹</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <a href="index.html" class="back-button">â† è¿”å›é¦–é¡µ</a>
        
        <header class="hero">
            <h1>ğŸ“¡ Communication é€šä¿¡æ¨¡å—</h1>
            <p class="hero-subtitle">è”é‚¦å­¦ä¹ å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡çš„æŠ½è±¡å±‚å’Œå®ç°</p>
        </header>

        <div class="content-section">
            <h2>æ¨¡å—æ¦‚è¿°</h2>
            <p>Communication æ¨¡å—æä¾›äº†è”é‚¦å­¦ä¹ ç³»ç»Ÿä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„æŠ½è±¡æ¥å£å’Œå…·ä½“å®ç°ã€‚è¯¥æ¨¡å—çš„è®¾è®¡ä½¿å¾—æ¡†æ¶å¯ä»¥æ”¯æŒä¸åŒçš„é€šä¿¡æ–¹å¼ï¼Œå¦‚æœ¬åœ°æ¨¡æ‹Ÿã€ç½‘ç»œé€šä¿¡ç­‰ï¼Œä¸ºåˆ†å¸ƒå¼è”é‚¦å­¦ä¹ æä¾›äº†çµæ´»çš„åŸºç¡€è®¾æ–½ã€‚</p>
            
            <div class="info-box">
                <strong>è®¾è®¡ç›®æ ‡ï¼š</strong> æä¾›ç»Ÿä¸€çš„é€šä¿¡æ¥å£ï¼Œæ”¯æŒå¤šç§é€šä¿¡å®ç°ï¼Œç¡®ä¿æ¶ˆæ¯ä¼ é€’çš„å¯é æ€§å’Œæ•ˆç‡ã€‚
            </div>
        </div>

        <div class="content-section">
            <h2>ğŸ“ æ–‡ä»¶ç»“æ„</h2>
            <pre><code>communication/
â”œâ”€â”€ __init__.py          # æ¨¡å—åˆå§‹åŒ–
â””â”€â”€ local.py            # æœ¬åœ°é€šä¿¡å®ç°ï¼ˆå•æœºæ¨¡æ‹Ÿï¼‰</code></pre>
        </div>

        <div class="content-section">
            <h2>ğŸ”§ BaseCommunication é€šä¿¡åŸºç±»</h2>
            <p>å®šä¹‰åœ¨ core/base.py ä¸­ï¼Œæ‰€æœ‰é€šä¿¡å®ç°å¿…é¡»ç»§æ‰¿çš„æŠ½è±¡åŸºç±»ã€‚</p>
            
            <h3>æŠ½è±¡æ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">send_to_server(client_id: str, data: Any)</div>
                    <div class="method-description">å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨æ¨é€æ›´æ–°</div>
                </li>
                <li>
                    <div class="method-signature">send_to_client(client_id: str, data: Any)</div>
                    <div class="method-description">æœåŠ¡å™¨å‘æŒ‡å®šå®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œç”¨äºå‘é€å…¨å±€æ¨¡å‹</div>
                </li>
                <li>
                    <div class="method-signature">broadcast_to_clients(data: Any)</div>
                    <div class="method-description">æœåŠ¡å™¨å‘æ‰€æœ‰å·²æ³¨å†Œå®¢æˆ·ç«¯å¹¿æ’­æ•°æ®</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ  LocalCommunication æœ¬åœ°é€šä¿¡å®ç°</h2>
            <p>BaseCommunication çš„å…·ä½“å®ç°ï¼Œç”¨äºåœ¨å•æœºç¯å¢ƒä¸­æ¨¡æ‹Ÿå®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡ã€‚é€šè¿‡å†…å­˜ç¼“å†²åŒºå®ç°æ¶ˆæ¯ä¼ é€’ï¼Œé€‚ç”¨äºå®éªŒå’Œå¼€å‘ç¯å¢ƒã€‚</p>
            
            <h3>æ ¸å¿ƒå±æ€§</h3>
            <table class="property-table">
                <tr>
                    <th>å±æ€§å</th>
                    <th>ç±»å‹</th>
                    <th>æè¿°</th>
                </tr>
                <tr>
                    <td>server_buffer</td>
                    <td>Dict[str, List[Any]]</td>
                    <td>æœåŠ¡å™¨æ¥æ”¶ç¼“å†²åŒºï¼ŒæŒ‰å®¢æˆ·ç«¯IDå­˜å‚¨æ¶ˆæ¯</td>
                </tr>
                <tr>
                    <td>client_buffers</td>
                    <td>Dict[str, List[Any]]</td>
                    <td>å®¢æˆ·ç«¯æ¥æ”¶ç¼“å†²åŒºï¼Œæ¯ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªç¼“å†²åŒº</td>
                </tr>
                <tr>
                    <td>client_list</td>
                    <td>List[str]</td>
                    <td>å·²æ³¨å†Œçš„å®¢æˆ·ç«¯IDåˆ—è¡¨</td>
                </tr>
            </table>

            <h3>æ ¸å¿ƒæ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">__init__()</div>
                    <div class="method-description">åˆå§‹åŒ–é€šä¿¡å®ä¾‹ï¼Œåˆ›å»ºç©ºçš„ç¼“å†²åŒºå’Œå®¢æˆ·ç«¯åˆ—è¡¨</div>
                </li>
                <li>
                    <div class="method-signature">register_client(client_id: str)</div>
                    <div class="method-description">æ³¨å†Œæ–°å®¢æˆ·ç«¯ï¼Œä¸ºå…¶åˆ›å»ºä¸“ç”¨çš„æ¥æ”¶ç¼“å†²åŒº</div>
                </li>
                <li>
                    <div class="method-signature">send_to_server(client_id: str, data: Any)</div>
                    <div class="method-description">å®¢æˆ·ç«¯å‘é€æ•°æ®åˆ°æœåŠ¡å™¨ï¼Œæ•°æ®ä¼šè¢«æ·±æ‹·è´ä»¥é¿å…å¼•ç”¨é—®é¢˜</div>
                </li>
                <li>
                    <div class="method-signature">send_to_client(client_id: str, data: Any)</div>
                    <div class="method-description">æœåŠ¡å™¨å‘é€æ•°æ®åˆ°æŒ‡å®šå®¢æˆ·ç«¯</div>
                </li>
                <li>
                    <div class="method-signature">broadcast_to_clients(data: Any)</div>
                    <div class="method-description">æœåŠ¡å™¨å‘æ‰€æœ‰å·²æ³¨å†Œå®¢æˆ·ç«¯å¹¿æ’­æ•°æ®</div>
                </li>
                <li>
                    <div class="method-signature">receive_from_server(client_id: str) -> List[Any]</div>
                    <div class="method-description">å®¢æˆ·ç«¯æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®ï¼Œæ¥æ”¶åæ¸…ç©ºç¼“å†²åŒº</div>
                </li>
                <li>
                    <div class="method-signature">receive_from_clients() -> Dict[str, List[Any]]</div>
                    <div class="method-description">æœåŠ¡å™¨æ¥æ”¶æ¥è‡ªæ‰€æœ‰å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œè¿”å›æŒ‰å®¢æˆ·ç«¯åˆ†ç»„çš„æ¶ˆæ¯</div>
                </li>
                <li>
                    <div class="method-signature">get_client_count() -> int</div>
                    <div class="method-description">è·å–å·²æ³¨å†Œçš„å®¢æˆ·ç«¯æ•°é‡</div>
                </li>
                <li>
                    <div class="method-signature">clear_buffers()</div>
                    <div class="method-description">æ¸…ç©ºæ‰€æœ‰ç¼“å†²åŒºï¼Œç”¨äºé‡ç½®é€šä¿¡çŠ¶æ€</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ”„ é€šä¿¡æµç¨‹</h2>
            <div class="architecture-content">
                <div class="architecture-diagram">
                    <div class="arch-layer">
                        <h4>1. å®¢æˆ·ç«¯æ³¨å†Œ</h4>
                        <div class="arch-components">
                            <span>register_client()</span>
                            <span>åˆ›å»ºç¼“å†²åŒº</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>2. æœåŠ¡å™¨å¹¿æ’­</h4>
                        <div class="arch-components">
                            <span>broadcast_to_clients()</span>
                            <span>å…¨å±€æ¨¡å‹å‚æ•°</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>3. å®¢æˆ·ç«¯æ¥æ”¶</h4>
                        <div class="arch-components">
                            <span>receive_from_server()</span>
                            <span>æœ¬åœ°è®­ç»ƒ</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>4. å®¢æˆ·ç«¯å‘é€</h4>
                        <div class="arch-components">
                            <span>send_to_server()</span>
                            <span>æ¨¡å‹æ›´æ–°</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>5. æœåŠ¡å™¨èšåˆ</h4>
                        <div class="arch-components">
                            <span>receive_from_clients()</span>
                            <span>å‚æ•°èšåˆ</span>
                        </div>
                    </div>
                </div>
                
                <div class="architecture-description">
                    <h4>é€šä¿¡ç‰¹ç‚¹</h4>
                    <ul>
                        <li><strong>æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶</strong>ï¼šä½¿ç”¨ç¼“å†²åŒºå­˜å‚¨æ¶ˆæ¯ï¼Œæ”¯æŒå¼‚æ­¥é€šä¿¡</li>
                        <li><strong>æ·±æ‹·è´ä¿æŠ¤</strong>ï¼šé¿å…æ•°æ®å¼•ç”¨é—®é¢˜ï¼Œç¡®ä¿æ•°æ®ç‹¬ç«‹æ€§</li>
                        <li><strong>æ‰¹é‡å¤„ç†</strong>ï¼šæ”¯æŒæ¥æ”¶å’Œå¤„ç†å¤šä¸ªæ¶ˆæ¯</li>
                        <li><strong>è‡ªåŠ¨æ¸…ç†</strong>ï¼šæ¥æ”¶æ¶ˆæ¯åè‡ªåŠ¨æ¸…ç©ºç¼“å†²åŒº</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹</h2>
            <h3>åŸºç¡€é€šä¿¡è®¾ç½®</h3>
            <pre><code># åˆ›å»ºé€šä¿¡å®ä¾‹
comm = LocalCommunication()

# æ³¨å†Œå®¢æˆ·ç«¯
client_ids = ["client_0", "client_1", "client_2"]
for client_id in client_ids:
    comm.register_client(client_id)

print(f"æ³¨å†Œå®¢æˆ·ç«¯æ•°é‡: {comm.get_client_count()}")</code></pre>

            <h3>æœåŠ¡å™¨å¹¿æ’­å…¨å±€æ¨¡å‹</h3>
            <pre><code># æœåŠ¡å™¨å¹¿æ’­å…¨å±€æ¨¡å‹å‚æ•°
global_params = server.send_global_model()
comm.broadcast_to_clients(global_params)

# å®¢æˆ·ç«¯æ¥æ”¶å…¨å±€æ¨¡å‹
for client_id in client_ids:
    messages = comm.receive_from_server(client_id)
    if messages:
        global_model_params = messages[0]  # è·å–æœ€æ–°çš„å…¨å±€æ¨¡å‹
        # å®¢æˆ·ç«¯ä½¿ç”¨å…¨å±€æ¨¡å‹è¿›è¡Œè®­ç»ƒ</code></pre>

            <h3>å®¢æˆ·ç«¯å‘é€è®­ç»ƒç»“æœ</h3>
            <pre><code># å®¢æˆ·ç«¯è®­ç»ƒå¹¶å‘é€ç»“æœ
for client in clients:
    # æ‰§è¡Œæœ¬åœ°è®­ç»ƒ
    result = client.train(global_model_params)
    
    # å‘é€è®­ç»ƒç»“æœåˆ°æœåŠ¡å™¨
    comm.send_to_server(client.client_id, result)

# æœåŠ¡å™¨æ¥æ”¶æ‰€æœ‰å®¢æˆ·ç«¯æ›´æ–°
client_updates_dict = comm.receive_from_clients()

# æ•´ç†å®¢æˆ·ç«¯æ›´æ–°ä¸ºåˆ—è¡¨
client_updates = []
for client_id, updates in client_updates_dict.items():
    if updates:
        client_updates.append(updates[0])  # è·å–æœ€æ–°æ›´æ–°</code></pre>

            <h3>å®Œæ•´çš„è”é‚¦å­¦ä¹ è½®æ¬¡é€šä¿¡</h3>
            <pre><code>def federated_round(server, clients, comm):
    # 1. æœåŠ¡å™¨å¹¿æ’­å…¨å±€æ¨¡å‹
    global_params = server.send_global_model()
    comm.broadcast_to_clients(global_params)
    
    # 2. å®¢æˆ·ç«¯æ¥æ”¶ã€è®­ç»ƒå¹¶å‘é€æ›´æ–°
    for client in clients:
        # æ¥æ”¶å…¨å±€æ¨¡å‹
        messages = comm.receive_from_server(client.client_id)
        if messages:
            global_model_params = messages[0]
            
            # æœ¬åœ°è®­ç»ƒ
            result = client.train(global_model_params)
            
            # å‘é€æ›´æ–°
            comm.send_to_server(client.client_id, result)
    
    # 3. æœåŠ¡å™¨æ¥æ”¶å¹¶èšåˆ
    client_updates_dict = comm.receive_from_clients()
    client_updates = [updates[0] for updates in client_updates_dict.values() if updates]
    
    # 4. æœåŠ¡å™¨èšåˆ
    server.aggregate(client_updates)
    
    return len(client_updates)</code></pre>
        </div>

        <div class="content-section">
            <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>
            <div class="warning-box">
                <strong>å†…å­˜ç®¡ç†ï¼š</strong> LocalCommunication ä½¿ç”¨å†…å­˜ç¼“å†²åŒºï¼Œå¤§é‡æ•°æ®å¯èƒ½å¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ã€‚å®šæœŸè°ƒç”¨ clear_buffers() æ¸…ç†ç¼“å†²åŒºã€‚
            </div>
            
            <div class="warning-box">
                <strong>æ•°æ®å®‰å…¨ï¼š</strong> æ‰€æœ‰æ•°æ®ä¼ è¾“éƒ½ä½¿ç”¨æ·±æ‹·è´ï¼Œç¡®ä¿æ•°æ®ç‹¬ç«‹æ€§ï¼Œä½†ä¼šå¢åŠ å†…å­˜å¼€é”€ã€‚
            </div>
            
            <div class="warning-box">
                <strong>å¹¶å‘å®‰å…¨ï¼š</strong> å½“å‰å®ç°ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦é¢å¤–çš„åŒæ­¥æœºåˆ¶ã€‚
            </div>
        </div>

        <div class="content-section">
            <h2>ğŸ”§ æ‰©å±•æŒ‡å—</h2>
            <h3>å®ç°ç½‘ç»œé€šä¿¡</h3>
            <pre><code>class NetworkCommunication(BaseCommunication):
    """åŸºäºç½‘ç»œçš„é€šä¿¡å®ç°ç¤ºä¾‹"""
    
    def __init__(self, server_host, server_port):
        self.server_host = server_host
        self.server_port = server_port
        self.client_sockets = {}
    
    def send_to_server(self, client_id: str, data: Any):
        # å®ç°ç½‘ç»œå‘é€é€»è¾‘
        serialized_data = pickle.dumps(data)
        # å‘é€åˆ°æœåŠ¡å™¨
        pass
    
    def broadcast_to_clients(self, data: Any):
        # å®ç°ç½‘ç»œå¹¿æ’­é€»è¾‘
        serialized_data = pickle.dumps(data)
        for client_socket in self.client_sockets.values():
            # å‘é€åˆ°æ¯ä¸ªå®¢æˆ·ç«¯
            pass</code></pre>

            <h3>æ·»åŠ æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</h3>
            <pre><code>class ReliableCommunication(LocalCommunication):
    """å¸¦æ¶ˆæ¯ç¡®è®¤çš„é€šä¿¡å®ç°"""
    
    def __init__(self):
        super().__init__()
        self.pending_messages = {}  # å¾…ç¡®è®¤æ¶ˆæ¯
        self.message_counter = 0
    
    def send_with_ack(self, sender_id: str, receiver_id: str, data: Any):
        message_id = self.message_counter
        self.message_counter += 1
        
        message = {
            'id': message_id,
            'data': data,
            'timestamp': time.time()
        }
        
        # å­˜å‚¨å¾…ç¡®è®¤æ¶ˆæ¯
        self.pending_messages[message_id] = message
        
        # å‘é€æ¶ˆæ¯
        if receiver_id == 'server':
            self.send_to_server(sender_id, message)
        else:
            self.send_to_client(receiver_id, message)
        
        return message_id</code></pre>
        </div>

        <div class="content-section">
            <h2>ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2>
            <ul>
                <li><strong>æ‰¹é‡ä¼ è¾“ï¼š</strong> å°†å¤šä¸ªå°æ¶ˆæ¯åˆå¹¶ä¸ºæ‰¹é‡ä¼ è¾“ï¼Œå‡å°‘é€šä¿¡å¼€é”€</li>
                <li><strong>æ•°æ®å‹ç¼©ï¼š</strong> å¯¹å¤§å‹æ¨¡å‹å‚æ•°è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘ä¼ è¾“æ—¶é—´</li>
                <li><strong>ç¼“å†²åŒºç®¡ç†ï¼š</strong> å®šæœŸæ¸…ç†ä¸éœ€è¦çš„ç¼“å†²åŒºï¼Œæ§åˆ¶å†…å­˜ä½¿ç”¨</li>
                <li><strong>å¼‚æ­¥å¤„ç†ï¼š</strong> ä½¿ç”¨å¼‚æ­¥IOæé«˜é€šä¿¡æ•ˆç‡</li>
            </ul>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 è”é‚¦å­¦ä¹ æ¡†æ¶. æ‰€æœ‰æƒåˆ©ä¿ç•™.</p>
            <p><a href="core.html">ä¸Šä¸€é¡µï¼šCore æ¨¡å—</a> | <a href="aggregation.html">ä¸‹ä¸€é¡µï¼šAggregation æ¨¡å—</a></p>
        </div>
    </footer>

    <script src="assets/script.js"></script>
</body>
</html>
