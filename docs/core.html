<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core æ ¸å¿ƒæ¨¡å— - è”é‚¦å­¦ä¹ æ¡†æ¶æ–‡æ¡£</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>ğŸš€ è”é‚¦å­¦ä¹ æ¡†æ¶</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                <li><a href="communication.html" class="nav-link">Communication</a></li>
                <li><a href="aggregation.html" class="nav-link">Aggregation</a></li>
                <li><a href="data.html" class="nav-link">Data</a></li>
                <li><a href="models.html" class="nav-link">Models</a></li>
                <li><a href="utils.html" class="nav-link">Utils</a></li>
                <li><a href="execution-flow.html" class="nav-link">æ‰§è¡Œæµç¨‹</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <a href="index.html" class="back-button">â† è¿”å›é¦–é¡µ</a>
        
        <header class="hero">
            <h1>ğŸ§  Core æ ¸å¿ƒæ¨¡å—</h1>
            <p class="hero-subtitle">è”é‚¦å­¦ä¹ æ¡†æ¶çš„æ ¸å¿ƒæŠ½è±¡å±‚å’Œå®ç°</p>
        </header>

        <div class="content-section">
            <h2>æ¨¡å—æ¦‚è¿°</h2>
            <p>Core æ¨¡å—æ˜¯æ•´ä¸ªè”é‚¦å­¦ä¹ æ¡†æ¶çš„æ ¸å¿ƒï¼Œæä¾›äº†å®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œæ¨¡å‹çš„åŸºç¡€æŠ½è±¡ç±»ï¼Œä»¥åŠå…·ä½“çš„å®ç°ã€‚è¯¥æ¨¡å—éµå¾ªé¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ï¼Œä½¿ç”¨æŠ½è±¡åŸºç±»ï¼ˆABCï¼‰ç¡®ä¿æ¥å£çš„ä¸€è‡´æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
            
            <div class="info-box">
                <strong>è®¾è®¡ç†å¿µï¼š</strong> é€šè¿‡æŠ½è±¡åŸºç±»å®šä¹‰ç»Ÿä¸€æ¥å£ï¼Œç¡®ä¿æ‰€æœ‰å­ç±»å®ç°ç‰¹å®šæ–¹æ³•ï¼Œæä¾›æ¡†æ¶çš„æ ¸å¿ƒæ‰©å±•ç‚¹ã€‚
            </div>
        </div>

        <div class="content-section">
            <h2>ğŸ“ æ–‡ä»¶ç»“æ„</h2>
            <pre><code>core/
â”œâ”€â”€ __init__.py          # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ base.py             # åŸºç¡€æŠ½è±¡ç±»å®šä¹‰
â”œâ”€â”€ client.py           # è”é‚¦å­¦ä¹ å®¢æˆ·ç«¯å®ç°
â””â”€â”€ server.py           # è”é‚¦å­¦ä¹ æœåŠ¡å™¨å®ç°</code></pre>
        </div>

        <div class="content-section">
            <h2>ğŸ”§ BaseClient å®¢æˆ·ç«¯åŸºç±»</h2>
            <p>æ‰€æœ‰è”é‚¦å­¦ä¹ å®¢æˆ·ç«¯å¿…é¡»ç»§æ‰¿çš„æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰äº†å®¢æˆ·ç«¯çš„æ ¸å¿ƒæ¥å£ã€‚</p>
            
            <h3>æ ¸å¿ƒå±æ€§</h3>
            <table class="property-table">
                <tr>
                    <th>å±æ€§å</th>
                    <th>ç±»å‹</th>
                    <th>æè¿°</th>
                </tr>
                <tr>
                    <td>client_id</td>
                    <td>str</td>
                    <td>å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†ç¬¦</td>
                </tr>
                <tr>
                    <td>model</td>
                    <td>Any</td>
                    <td>å®¢æˆ·ç«¯æœ¬åœ°æ¨¡å‹å®ä¾‹</td>
                </tr>
                <tr>
                    <td>data</td>
                    <td>Any</td>
                    <td>å®¢æˆ·ç«¯æœ¬åœ°æ•°æ®</td>
                </tr>
            </table>

            <h3>æŠ½è±¡æ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">train(global_model_params: Dict[str, Any]) -> Dict[str, Any]</div>
                    <div class="method-description">ä½¿ç”¨å…¨å±€æ¨¡å‹å‚æ•°è¿›è¡Œæœ¬åœ°è®­ç»ƒï¼Œè¿”å›è®­ç»ƒåçš„æ¨¡å‹å‚æ•°</div>
                </li>
                <li>
                    <div class="method-signature">set_data(data)</div>
                    <div class="method-description">è®¾ç½®å®¢æˆ·ç«¯çš„æœ¬åœ°è®­ç»ƒæ•°æ®</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ–¥ï¸ BaseServer æœåŠ¡å™¨åŸºç±»</h2>
            <p>è”é‚¦å­¦ä¹ æœåŠ¡å™¨çš„æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰äº†æœåŠ¡å™¨ç«¯çš„æ ¸å¿ƒåŠŸèƒ½æ¥å£ã€‚</p>
            
            <h3>æ ¸å¿ƒå±æ€§</h3>
            <table class="property-table">
                <tr>
                    <th>å±æ€§å</th>
                    <th>ç±»å‹</th>
                    <th>æè¿°</th>
                </tr>
                <tr>
                    <td>global_model</td>
                    <td>Any</td>
                    <td>å…¨å±€æ¨¡å‹å®ä¾‹</td>
                </tr>
                <tr>
                    <td>clients</td>
                    <td>List</td>
                    <td>æ³¨å†Œçš„å®¢æˆ·ç«¯åˆ—è¡¨</td>
                </tr>
            </table>

            <h3>æŠ½è±¡æ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">aggregate(client_updates: List[Dict[str, Any]]) -> Dict[str, Any]</div>
                    <div class="method-description">èšåˆå®¢æˆ·ç«¯æ›´æ–°ï¼Œè¿”å›èšåˆåçš„å…¨å±€æ¨¡å‹å‚æ•°</div>
                </li>
                <li>
                    <div class="method-signature">initialize_model()</div>
                    <div class="method-description">åˆå§‹åŒ–å…¨å±€æ¨¡å‹</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ§® BaseModel æ¨¡å‹åŸºç±»</h2>
            <p>æ‰€æœ‰æ¨¡å‹å®ç°çš„åŸºç¡€æŠ½è±¡ç±»ï¼Œæä¾›ç»Ÿä¸€çš„æ¨¡å‹æ¥å£å’Œä¼˜åŒ–å™¨ç®¡ç†ã€‚</p>
            
            <h3>æ ¸å¿ƒå±æ€§</h3>
            <table class="property-table">
                <tr>
                    <th>å±æ€§å</th>
                    <th>ç±»å‹</th>
                    <th>æè¿°</th>
                </tr>
                <tr>
                    <td>optimizer_config</td>
                    <td>Dict[str, Any]</td>
                    <td>ä¼˜åŒ–å™¨é…ç½®å‚æ•°</td>
                </tr>
                <tr>
                    <td>optimizer</td>
                    <td>Any</td>
                    <td>ä¼˜åŒ–å™¨å®ä¾‹</td>
                </tr>
            </table>

            <h3>æ ¸å¿ƒæ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">create_optimizer(model_parameters)</div>
                    <div class="method-description">åˆ›å»ºAdamWä¼˜åŒ–å™¨ï¼Œæ”¯æŒè‡ªå®šä¹‰é…ç½®æˆ–ä½¿ç”¨é»˜è®¤é…ç½®</div>
                </li>
                <li>
                    <div class="method-signature">_ensure_device_compatibility(*tensors)</div>
                    <div class="method-description">ç¡®ä¿å¼ é‡åœ¨æ­£ç¡®çš„è®¾å¤‡ä¸Šï¼ˆCPU/GPUï¼‰</div>
                </li>
                <li>
                    <div class="method-signature">_get_model_device()</div>
                    <div class="method-description">è·å–æ¨¡å‹æ‰€åœ¨çš„è®¾å¤‡</div>
                </li>
            </ul>

            <h3>æŠ½è±¡æ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">get_parameters() -> Dict[str, Any]</div>
                    <div class="method-description">è·å–æ¨¡å‹å‚æ•°å­—å…¸</div>
                </li>
                <li>
                    <div class="method-signature">set_parameters(params: Dict[str, Any])</div>
                    <div class="method-description">è®¾ç½®æ¨¡å‹å‚æ•°</div>
                </li>
                <li>
                    <div class="method-signature">train_step(data, labels)</div>
                    <div class="method-description">æ‰§è¡Œå•æ­¥è®­ç»ƒ</div>
                </li>
                <li>
                    <div class="method-signature">evaluate(data, labels)</div>
                    <div class="method-description">è¯„ä¼°æ¨¡å‹æ€§èƒ½</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ“¡ BaseCommunication é€šä¿¡åŸºç±»</h2>
            <p>å®šä¹‰å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡çš„æŠ½è±¡æ¥å£ï¼Œæ”¯æŒä¸åŒçš„é€šä¿¡å®ç°æ–¹å¼ã€‚</p>
            
            <h3>æŠ½è±¡æ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">send_to_server(client_id: str, data: Any)</div>
                    <div class="method-description">å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®</div>
                </li>
                <li>
                    <div class="method-signature">send_to_client(client_id: str, data: Any)</div>
                    <div class="method-description">æœåŠ¡å™¨å‘æŒ‡å®šå®¢æˆ·ç«¯å‘é€æ•°æ®</div>
                </li>
                <li>
                    <div class="method-signature">broadcast_to_clients(data: Any)</div>
                    <div class="method-description">æœåŠ¡å™¨å‘æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­æ•°æ®</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ”§ FederatedClient å®¢æˆ·ç«¯å®ç°</h2>
            <p>BaseClient çš„å…·ä½“å®ç°ï¼Œæä¾›å®Œæ•´çš„è”é‚¦å­¦ä¹ å®¢æˆ·ç«¯åŠŸèƒ½ã€‚</p>
            
            <h3>åˆå§‹åŒ–å‚æ•°</h3>
            <table class="property-table">
                <tr>
                    <th>å‚æ•°å</th>
                    <th>ç±»å‹</th>
                    <th>æè¿°</th>
                </tr>
                <tr>
                    <td>client_id</td>
                    <td>str</td>
                    <td>å®¢æˆ·ç«¯æ ‡è¯†ç¬¦</td>
                </tr>
                <tr>
                    <td>model</td>
                    <td>BaseModel</td>
                    <td>æœ¬åœ°æ¨¡å‹å®ä¾‹</td>
                </tr>
                <tr>
                    <td>data_loader</td>
                    <td>DataLoader</td>
                    <td>æœ¬åœ°æ•°æ®åŠ è½½å™¨</td>
                </tr>
                <tr>
                    <td>epochs</td>
                    <td>int</td>
                    <td>æœ¬åœ°è®­ç»ƒè½®æ•°ï¼Œé»˜è®¤ä¸º1</td>
                </tr>
                <tr>
                    <td>learning_rate</td>
                    <td>float</td>
                    <td>å­¦ä¹ ç‡ï¼Œé»˜è®¤ä¸º0.01</td>
                </tr>
                <tr>
                    <td>device</td>
                    <td>torch.device</td>
                    <td>è®¡ç®—è®¾å¤‡ï¼Œé»˜è®¤ä¸ºCPU</td>
                </tr>
            </table>

            <h3>æ ¸å¿ƒæ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">train(global_model_params, show_progress=False)</div>
                    <div class="method-description">æ‰§è¡Œæœ¬åœ°è®­ç»ƒï¼Œæ”¯æŒè¿›åº¦æ˜¾ç¤ºï¼Œè¿”å›æ¨¡å‹å‚æ•°å’Œè®­ç»ƒæŒ‡æ ‡</div>
                </li>
                <li>
                    <div class="method-signature">evaluate_on_local_data()</div>
                    <div class="method-description">åœ¨æœ¬åœ°æ•°æ®ä¸Šè¯„ä¼°æ¨¡å‹æ€§èƒ½</div>
                </li>
                <li>
                    <div class="method-signature">set_data(data_loader)</div>
                    <div class="method-description">è®¾ç½®æ•°æ®åŠ è½½å™¨</div>
                </li>
            </ul>

            <div class="info-box">
                <strong>ç‰¹æ€§ï¼š</strong> æ”¯æŒå¤šè½®æœ¬åœ°è®­ç»ƒã€è‡ªåŠ¨è®¾å¤‡ç®¡ç†ã€è®­ç»ƒæŒ‡æ ‡æ”¶é›†å’Œè¿›åº¦æ˜¾ç¤ºã€‚
            </div>
        </div>

        <div class="content-section">
            <h2>ğŸ–¥ï¸ FederatedServer æœåŠ¡å™¨å®ç°</h2>
            <p>BaseServer çš„å…·ä½“å®ç°ï¼Œæä¾›å®Œæ•´çš„è”é‚¦å­¦ä¹ æœåŠ¡å™¨åŠŸèƒ½ã€‚</p>
            
            <h3>åˆå§‹åŒ–å‚æ•°</h3>
            <table class="property-table">
                <tr>
                    <th>å‚æ•°å</th>
                    <th>ç±»å‹</th>
                    <th>æè¿°</th>
                </tr>
                <tr>
                    <td>global_model</td>
                    <td>BaseModel</td>
                    <td>å…¨å±€æ¨¡å‹å®ä¾‹</td>
                </tr>
                <tr>
                    <td>aggregator</td>
                    <td>FederatedAveraging</td>
                    <td>æ¨¡å‹èšåˆç®—æ³•</td>
                </tr>
            </table>

            <h3>æ ¸å¿ƒå±æ€§</h3>
            <table class="property-table">
                <tr>
                    <th>å±æ€§å</th>
                    <th>ç±»å‹</th>
                    <th>æè¿°</th>
                </tr>
                <tr>
                    <td>round_num</td>
                    <td>int</td>
                    <td>å½“å‰è®­ç»ƒè½®æ¬¡</td>
                </tr>
                <tr>
                    <td>client_weights</td>
                    <td>Dict[str, float]</td>
                    <td>å®¢æˆ·ç«¯æƒé‡å­—å…¸</td>
                </tr>
            </table>

            <h3>æ ¸å¿ƒæ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">aggregate(client_updates)</div>
                    <div class="method-description">ä½¿ç”¨èšåˆç®—æ³•èšåˆå®¢æˆ·ç«¯æ›´æ–°ï¼Œæ›´æ–°å…¨å±€æ¨¡å‹</div>
                </li>
                <li>
                    <div class="method-signature">send_global_model()</div>
                    <div class="method-description">è·å–å…¨å±€æ¨¡å‹å‚æ•°ï¼Œç”¨äºå‘é€ç»™å®¢æˆ·ç«¯</div>
                </li>
                <li>
                    <div class="method-signature">set_client_weights(client_weights)</div>
                    <div class="method-description">è®¾ç½®å®¢æˆ·ç«¯æƒé‡ï¼Œç”¨äºåŠ æƒèšåˆ</div>
                </li>
                <li>
                    <div class="method-signature">evaluate_global_model(test_data, test_labels)</div>
                    <div class="method-description">è¯„ä¼°å…¨å±€æ¨¡å‹åœ¨æµ‹è¯•æ•°æ®ä¸Šçš„æ€§èƒ½</div>
                </li>
                <li>
                    <div class="method-signature">evaluate_with_dataloader(test_dataloader)</div>
                    <div class="method-description">ä½¿ç”¨æ•°æ®åŠ è½½å™¨è¯„ä¼°å…¨å±€æ¨¡å‹</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹</h2>
            <h3>åˆ›å»ºå®¢æˆ·ç«¯</h3>
            <pre><code># åˆ›å»ºæ¨¡å‹å’Œæ•°æ®åŠ è½½å™¨
model = ModelFactory.create_model(model_config)
data_loader = get_client_dataloaders([dataset_config])[0]

# åˆ›å»ºå®¢æˆ·ç«¯
client = FederatedClient(
    client_id="client_0",
    model=model,
    data_loader=data_loader,
    epochs=5,
    learning_rate=0.001,
    device=torch.device('cuda')
)

# æ‰§è¡Œè®­ç»ƒ
result = client.train(global_model_params)
print(f"è®­ç»ƒæŸå¤±: {result['metrics']['loss']}")
print(f"å‡†ç¡®ç‡: {result['metrics']['accuracy']}")</code></pre>

            <h3>åˆ›å»ºæœåŠ¡å™¨</h3>
            <pre><code># åˆ›å»ºå…¨å±€æ¨¡å‹å’Œèšåˆå™¨
global_model = ModelFactory.create_model(model_config)
aggregator = FederatedAveraging()

# åˆ›å»ºæœåŠ¡å™¨
server = FederatedServer(global_model, aggregator)

# èšåˆå®¢æˆ·ç«¯æ›´æ–°
aggregated_params = server.aggregate(client_updates)

# è¯„ä¼°å…¨å±€æ¨¡å‹
metrics = server.evaluate_with_dataloader(test_dataloader)</code></pre>
        </div>

        <div class="content-section">
            <h2>ğŸ”§ æ‰©å±•æŒ‡å—</h2>
            <div class="warning-box">
                <strong>æ‰©å±•æ–°å®¢æˆ·ç«¯ç±»å‹ï¼š</strong> ç»§æ‰¿ BaseClient å¹¶å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼Œç¡®ä¿éµå¾ªè®­ç»ƒå’Œæ•°æ®è®¾ç½®çš„æ¥å£è§„èŒƒã€‚
            </div>
            
            <div class="warning-box">
                <strong>æ‰©å±•æ–°æœåŠ¡å™¨ç±»å‹ï¼š</strong> ç»§æ‰¿ BaseServer å¹¶å®ç°èšåˆé€»è¾‘ï¼Œå¯ä»¥æ”¯æŒä¸åŒçš„è”é‚¦å­¦ä¹ ç®—æ³•ã€‚
            </div>
            
            <div class="warning-box">
                <strong>æ‰©å±•æ–°æ¨¡å‹ç±»å‹ï¼š</strong> ç»§æ‰¿ BaseModel å¹¶å®ç°å‚æ•°è·å–/è®¾ç½®ã€è®­ç»ƒå’Œè¯„ä¼°æ–¹æ³•ã€‚
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 è”é‚¦å­¦ä¹ æ¡†æ¶. æ‰€æœ‰æƒåˆ©ä¿ç•™.</p>
            <p><a href="index.html">è¿”å›é¦–é¡µ</a> | <a href="communication.html">ä¸‹ä¸€é¡µï¼šCommunication æ¨¡å—</a></p>
        </div>
    </footer>

    <script src="assets/script.js"></script>
</body>
</html>
