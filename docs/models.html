<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Models æ¨¡å‹æ¨¡å— - è”é‚¦å­¦ä¹ æ¡†æ¶æ–‡æ¡£</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>ğŸš€ è”é‚¦å­¦ä¹ æ¡†æ¶</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                <li><a href="core.html" class="nav-link">Core</a></li>
                <li><a href="communication.html" class="nav-link">Communication</a></li>
                <li><a href="aggregation.html" class="nav-link">Aggregation</a></li>
                <li><a href="data.html" class="nav-link">Data</a></li>
                <li><a href="utils.html" class="nav-link">Utils</a></li>
                <li><a href="execution-flow.html" class="nav-link">æ‰§è¡Œæµç¨‹</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <a href="index.html" class="back-button">â† è¿”å›é¦–é¡µ</a>
        
        <header class="hero">
            <h1>ğŸ§  Models æ¨¡å‹æ¨¡å—</h1>
            <p class="hero-subtitle">æ·±åº¦å­¦ä¹ æ¨¡å‹çš„å®ç°å’Œè”é‚¦å­¦ä¹ é€‚é…</p>
        </header>

        <div class="content-section">
            <h2>æ¨¡å—æ¦‚è¿°</h2>
            <p>Models æ¨¡å—åŒ…å«äº†è”é‚¦å­¦ä¹ æ¡†æ¶æ”¯æŒçš„å„ç§æ·±åº¦å­¦ä¹ æ¨¡å‹å®ç°ã€‚æ‰€æœ‰æ¨¡å‹éƒ½ç»§æ‰¿è‡ªBaseModelåŸºç±»ï¼Œç¡®ä¿ç»Ÿä¸€çš„æ¥å£å’Œè”é‚¦å­¦ä¹ å…¼å®¹æ€§ã€‚ç›®å‰æ”¯æŒCNNå’ŒCLIPç­‰æ¨¡å‹ï¼Œä¸ºä¸åŒçš„è”é‚¦å­¦ä¹ åœºæ™¯æä¾›äº†çµæ´»çš„æ¨¡å‹é€‰æ‹©ã€‚</p>
            
            <div class="info-box">
                <strong>è®¾è®¡ç‰¹ç‚¹ï¼š</strong> ç»Ÿä¸€çš„æ¨¡å‹æ¥å£ã€è‡ªåŠ¨è®¾å¤‡ç®¡ç†ã€ä¼˜åŒ–å™¨é›†æˆã€å‚æ•°åºåˆ—åŒ–æ”¯æŒã€‚
            </div>
        </div>

        <div class="content-section">
            <h2>ğŸ“ æ–‡ä»¶ç»“æ„</h2>
            <pre><code>models/
â”œâ”€â”€ __init__.py          # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ base.py             # åŸºç¡€æ¨¡å‹ç±»ï¼ˆå·²è¿ç§»åˆ°core/base.pyï¼‰
â”œâ”€â”€ cnn.py              # CNN å·ç§¯ç¥ç»ç½‘ç»œæ¨¡å‹
â””â”€â”€ clip.py             # CLIP å¤šæ¨¡æ€æ¨¡å‹</code></pre>
        </div>

        <div class="content-section">
            <h2>ğŸ”§ BaseModel åŸºç¡€æ¨¡å‹ç±»</h2>
            <p>å®šä¹‰åœ¨ core/base.py ä¸­ï¼Œæ‰€æœ‰æ¨¡å‹å¿…é¡»ç»§æ‰¿çš„æŠ½è±¡åŸºç±»ã€‚æä¾›ç»Ÿä¸€çš„æ¨¡å‹æ¥å£å’ŒåŸºç¡€åŠŸèƒ½ã€‚</p>
            
            <h3>æ ¸å¿ƒç‰¹æ€§</h3>
            <ul>
                <li><strong>ä¼˜åŒ–å™¨ç®¡ç†ï¼š</strong> è‡ªåŠ¨åˆ›å»ºå’Œé…ç½®AdamWä¼˜åŒ–å™¨</li>
                <li><strong>è®¾å¤‡å…¼å®¹ï¼š</strong> è‡ªåŠ¨å¤„ç†CPU/GPUè®¾å¤‡åˆ‡æ¢</li>
                <li><strong>å‚æ•°åºåˆ—åŒ–ï¼š</strong> æ”¯æŒæ¨¡å‹å‚æ•°çš„è·å–å’Œè®¾ç½®</li>
                <li><strong>è®­ç»ƒæ¥å£ï¼š</strong> ç»Ÿä¸€çš„è®­ç»ƒå’Œè¯„ä¼°æ–¹æ³•</li>
            </ul>

            <h3>å¿…é¡»å®ç°çš„æŠ½è±¡æ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">get_parameters() -> Dict[str, Any]</div>
                    <div class="method-description">è·å–æ¨¡å‹å‚æ•°å­—å…¸ï¼Œç”¨äºè”é‚¦å­¦ä¹ å‚æ•°ä¼ è¾“</div>
                </li>
                <li>
                    <div class="method-signature">set_parameters(params: Dict[str, Any])</div>
                    <div class="method-description">è®¾ç½®æ¨¡å‹å‚æ•°ï¼Œç”¨äºæ¥æ”¶å…¨å±€æ¨¡å‹å‚æ•°</div>
                </li>
                <li>
                    <div class="method-signature">train_step(data, labels)</div>
                    <div class="method-description">æ‰§è¡Œå•æ­¥è®­ç»ƒï¼Œè¿”å›æŸå¤±å€¼</div>
                </li>
                <li>
                    <div class="method-signature">evaluate(data, labels)</div>
                    <div class="method-description">è¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œè¿”å›æŒ‡æ ‡å­—å…¸</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ–¼ï¸ CNNModel å·ç§¯ç¥ç»ç½‘ç»œ</h2>
            <p>ç»å…¸çš„CNNæ¨¡å‹å®ç°ï¼Œé€‚é…224Ã—224 RGBå›¾åƒè¾“å…¥ï¼ŒåŸºäºè”é‚¦å­¦ä¹ ç»å…¸æ¶æ„è®¾è®¡ã€‚</p>
            
            <h3>æ¨¡å‹æ¶æ„</h3>
            <div class="architecture-content">
                <div class="architecture-diagram">
                    <div class="arch-layer">
                        <h4>è¾“å…¥å±‚</h4>
                        <div class="arch-components">
                            <span>3Ã—224Ã—224</span>
                            <span>RGBå›¾åƒ</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>å·ç§¯å±‚1</h4>
                        <div class="arch-components">
                            <span>5Ã—5, 32é€šé“</span>
                            <span>ReLU + MaxPool</span>
                            <span>â†’ 32Ã—110Ã—110</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>å·ç§¯å±‚2</h4>
                        <div class="arch-components">
                            <span>5Ã—5, 64é€šé“</span>
                            <span>ReLU + MaxPool</span>
                            <span>â†’ 64Ã—53Ã—53</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>å·ç§¯å±‚3</h4>
                        <div class="arch-components">
                            <span>5Ã—5, 128é€šé“</span>
                            <span>ReLU + MaxPool</span>
                            <span>â†’ 128Ã—24Ã—24</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>å·ç§¯å±‚4</h4>
                        <div class="arch-components">
                            <span>5Ã—5, 256é€šé“</span>
                            <span>ReLU + MaxPool</span>
                            <span>â†’ 256Ã—10Ã—10</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>å…¨è¿æ¥å±‚</h4>
                        <div class="arch-components">
                            <span>512å•å…ƒ ReLU</span>
                            <span>10å•å…ƒè¾“å‡º</span>
                        </div>
                    </div>
                </div>
                
                <div class="architecture-description">
                    <h4>æ¶æ„ç‰¹ç‚¹</h4>
                    <ul>
                        <li><strong>æ·±åº¦ç‰¹å¾æå–ï¼š</strong> 4å±‚å·ç§¯é€æ­¥æå–ç‰¹å¾</li>
                        <li><strong>æ± åŒ–é™ç»´ï¼š</strong> MaxPool2Då‡å°‘ç©ºé—´ç»´åº¦</li>
                        <li><strong>éçº¿æ€§æ¿€æ´»ï¼š</strong> ReLUæ¿€æ´»å‡½æ•°</li>
                        <li><strong>åˆ†ç±»è¾“å‡ºï¼š</strong> æœ€ç»ˆè¾“å‡º10ç±»æ¦‚ç‡</li>
                    </ul>
                </div>
            </div>

            <h3>æ ¸å¿ƒæ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">__init__(optimizer_config: Dict[str, Any] = None)</div>
                    <div class="method-description">åˆå§‹åŒ–CNNæ¨¡å‹ï¼Œåˆ›å»ºç½‘ç»œç»“æ„å’Œä¼˜åŒ–å™¨</div>
                </li>
                <li>
                    <div class="method-signature">forward(x: torch.Tensor) -> torch.Tensor</div>
                    <div class="method-description">å‰å‘ä¼ æ’­ï¼Œè¾“å…¥å›¾åƒè¿”å›åˆ†ç±»logits</div>
                </li>
                <li>
                    <div class="method-signature">get_parameters() -> Dict[str, torch.Tensor]</div>
                    <div class="method-description">è·å–æ¨¡å‹æ‰€æœ‰å¯è®­ç»ƒå‚æ•°</div>
                </li>
                <li>
                    <div class="method-signature">set_parameters(params: Dict[str, torch.Tensor])</div>
                    <div class="method-description">è®¾ç½®æ¨¡å‹å‚æ•°ï¼Œç”¨äºè”é‚¦å­¦ä¹ å‚æ•°æ›´æ–°</div>
                </li>
                <li>
                    <div class="method-signature">train_step(data: torch.Tensor, labels: torch.Tensor) -> float</div>
                    <div class="method-description">æ‰§è¡Œå•æ­¥è®­ç»ƒï¼Œè¿”å›æŸå¤±å€¼</div>
                </li>
                <li>
                    <div class="method-signature">evaluate(data: torch.Tensor, labels: torch.Tensor) -> Dict[str, float]</div>
                    <div class="method-description">è¯„ä¼°æ¨¡å‹ï¼Œè¿”å›æŸå¤±å’Œå‡†ç¡®ç‡</div>
                </li>
            </ul>

            <h3>æ¨¡å‹è§„æ ¼</h3>
            <table class="property-table">
                <tr>
                    <th>å±æ€§</th>
                    <th>å€¼</th>
                </tr>
                <tr>
                    <td>è¾“å…¥å°ºå¯¸</td>
                    <td>3 Ã— 224 Ã— 224</td>
                </tr>
                <tr>
                    <td>å‚æ•°æ•°é‡</td>
                    <td>çº¦ 6.8M</td>
                </tr>
                <tr>
                    <td>è¾“å‡ºç±»åˆ«</td>
                    <td>10</td>
                </tr>
                <tr>
                    <td>æŸå¤±å‡½æ•°</td>
                    <td>CrossEntropyLoss</td>
                </tr>
                <tr>
                    <td>ä¼˜åŒ–å™¨</td>
                    <td>AdamW</td>
                </tr>
                <tr>
                    <td>è®¾å¤‡æ”¯æŒ</td>
                    <td>CPU / CUDA</td>
                </tr>
            </table>
        </div>

        <div class="content-section">
            <h2>ğŸ¯ CLIP å¤šæ¨¡æ€æ¨¡å‹</h2>
            <p>åŸºäºHugging Face transformersçš„CLIPæ¨¡å‹å®ç°ï¼Œæ”¯æŒå›¾åƒå’Œæ–‡æœ¬çš„å¤šæ¨¡æ€è”é‚¦å­¦ä¹ ã€‚</p>
            
            <h3>CLIPæ¶æ„ç‰¹ç‚¹</h3>
            <div class="architecture-content">
                <div class="architecture-diagram">
                    <div class="arch-layer">
                        <h4>å›¾åƒç¼–ç å™¨</h4>
                        <div class="arch-components">
                            <span>Vision Transformer</span>
                            <span>ResNet-50</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>æ–‡æœ¬ç¼–ç å™¨</h4>
                        <div class="arch-components">
                            <span>Transformer</span>
                            <span>æ–‡æœ¬åµŒå…¥</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>æŠ•å½±å±‚</h4>
                        <div class="arch-components">
                            <span>å›¾åƒæŠ•å½±</span>
                            <span>æ–‡æœ¬æŠ•å½±</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <h4>å¯¹æ¯”å­¦ä¹ </h4>
                        <div class="arch-components">
                            <span>ç›¸ä¼¼åº¦è®¡ç®—</span>
                            <span>InfoNCEæŸå¤±</span>
                        </div>
                    </div>
                </div>
                
                <div class="architecture-description">
                    <h4>å¤šæ¨¡æ€ç‰¹æ€§</h4>
                    <ul>
                        <li><strong>é›¶æ ·æœ¬åˆ†ç±»ï¼š</strong> æ— éœ€è®­ç»ƒå³å¯åˆ†ç±»æ–°ç±»åˆ«</li>
                        <li><strong>å›¾æ–‡ç†è§£ï¼š</strong> åŒæ—¶å¤„ç†å›¾åƒå’Œæ–‡æœ¬</li>
                        <li><strong>è·¨æ¨¡æ€æ£€ç´¢ï¼š</strong> å›¾åƒ-æ–‡æœ¬ç›¸äº’æ£€ç´¢</li>
                        <li><strong>çŸ¥è¯†è’¸é¦ï¼š</strong> é¢„è®­ç»ƒçŸ¥è¯†è¿ç§»</li>
                    </ul>
                </div>
            </div>

            <h3>é¢„è®­ç»ƒæ¨¡å‹æ”¯æŒ</h3>
            <table class="property-table">
                <tr>
                    <th>æ¨¡å‹åç§°</th>
                    <th>å›¾åƒç¼–ç å™¨</th>
                    <th>å‚æ•°é‡</th>
                    <th>ç”¨é€”</th>
                </tr>
                <tr>
                    <td>openai/clip-vit-base-patch32</td>
                    <td>ViT-B/32</td>
                    <td>151M</td>
                    <td>å¿«é€Ÿå®éªŒ</td>
                </tr>
                <tr>
                    <td>openai/clip-vit-base-patch16</td>
                    <td>ViT-B/16</td>
                    <td>149M</td>
                    <td>é«˜ç²¾åº¦</td>
                </tr>
                <tr>
                    <td>openai/clip-vit-large-patch14</td>
                    <td>ViT-L/14</td>
                    <td>428M</td>
                    <td>æœ€ä½³æ€§èƒ½</td>
                </tr>
            </table>

            <h3>æ ¸å¿ƒæ–¹æ³•</h3>
            <ul class="method-list">
                <li>
                    <div class="method-signature">__init__(optimizer_config: Dict[str, Any] = None)</div>
                    <div class="method-description">åˆå§‹åŒ–CLIPæ¨¡å‹ï¼ŒåŠ è½½é¢„è®­ç»ƒæƒé‡</div>
                </li>
                <li>
                    <div class="method-signature">get_image_features(images: torch.Tensor) -> torch.Tensor</div>
                    <div class="method-description">æå–å›¾åƒç‰¹å¾å‘é‡</div>
                </li>
                <li>
                    <div class="method-signature">get_text_features(text_inputs: Dict) -> torch.Tensor</div>
                    <div class="method-description">æå–æ–‡æœ¬ç‰¹å¾å‘é‡</div>
                </li>
                <li>
                    <div class="method-signature">zero_shot_classify(images: torch.Tensor, class_names: List[str]) -> torch.Tensor</div>
                    <div class="method-description">é›¶æ ·æœ¬å›¾åƒåˆ†ç±»</div>
                </li>
                <li>
                    <div class="method-signature">contrastive_loss(image_features: torch.Tensor, text_features: torch.Tensor) -> torch.Tensor</div>
                    <div class="method-description">è®¡ç®—å¯¹æ¯”å­¦ä¹ æŸå¤±</div>
                </li>
            </ul>
        </div>

        <div class="content-section">
            <h2>ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹</h2>
            
            <h3>CNNæ¨¡å‹åŸºç¡€ä½¿ç”¨</h3>
            <pre><code># åˆ›å»ºCNNæ¨¡å‹
from models.cnn import CNNModel

# ä½¿ç”¨é»˜è®¤ä¼˜åŒ–å™¨é…ç½®
model = CNNModel()

# ä½¿ç”¨è‡ªå®šä¹‰ä¼˜åŒ–å™¨é…ç½®
optimizer_config = {
    'type': 'AdamW',
    'lr': 0.001,
    'weight_decay': 0.01
}
model = CNNModel(optimizer_config)

# è®­ç»ƒç¤ºä¾‹
model.train()
for batch_data, batch_labels in dataloader:
    loss = model.train_step(batch_data, batch_labels)
    print(f"è®­ç»ƒæŸå¤±: {loss:.4f}")

# è¯„ä¼°ç¤ºä¾‹
model.eval()
metrics = model.evaluate(test_data, test_labels)
print(f"æµ‹è¯•å‡†ç¡®ç‡: {metrics['accuracy']:.4f}")
print(f"æµ‹è¯•æŸå¤±: {metrics['loss']:.4f}")</code></pre>

            <h3>CLIPæ¨¡å‹é›¶æ ·æœ¬åˆ†ç±»</h3>
            <pre><code># åˆ›å»ºCLIPæ¨¡å‹
from models.clip import CLIPModel

model = CLIPModel()

# å®šä¹‰ç±»åˆ«æ ‡ç­¾
class_names = ["cat", "dog", "bird", "car", "airplane"]

# é›¶æ ·æœ¬åˆ†ç±»
with torch.no_grad():
    predictions = model.zero_shot_classify(images, class_names)
    predicted_classes = predictions.argmax(dim=1)
    
    for i, pred_idx in enumerate(predicted_classes):
        print(f"å›¾åƒ {i}: {class_names[pred_idx]}")

# è·å–å›¾åƒå’Œæ–‡æœ¬ç‰¹å¾
image_features = model.get_image_features(images)
text_features = model.get_text_features(text_inputs)

# è®¡ç®—ç›¸ä¼¼åº¦
similarity = torch.cosine_similarity(image_features, text_features)
print(f"å›¾æ–‡ç›¸ä¼¼åº¦: {similarity.mean().item():.4f}")</code></pre>

            <h3>è”é‚¦å­¦ä¹ ä¸­çš„æ¨¡å‹ä½¿ç”¨</h3>
            <pre><code># åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨
class FederatedClient(BaseClient):
    def __init__(self, client_id, model_type="cnn", **kwargs):
        super().__init__(client_id)
        
        # æ ¹æ®ç±»å‹åˆ›å»ºæ¨¡å‹
        if model_type == "cnn":
            self.model = CNNModel(kwargs.get('optimizer_config'))
        elif model_type == "clip":
            self.model = CLIPModel(kwargs.get('optimizer_config'))
        else:
            raise ValueError(f"ä¸æ”¯æŒçš„æ¨¡å‹ç±»å‹: {model_type}")
    
    def train(self, global_model_params):
        # è®¾ç½®å…¨å±€æ¨¡å‹å‚æ•°
        if global_model_params:
            self.model.set_parameters(global_model_params)
        
        # æœ¬åœ°è®­ç»ƒ
        total_loss = 0.0
        for batch_data, batch_labels in self.data_loader:
            loss = self.model.train_step(batch_data, batch_labels)
            total_loss += loss
        
        # è¿”å›æ›´æ–°åçš„å‚æ•°
        return {
            'parameters': self.model.get_parameters(),
            'metrics': {'loss': total_loss / len(self.data_loader)}
        }</code></pre>

            <h3>æ¨¡å‹å‚æ•°ç®¡ç†</h3>
            <pre><code># ä¿å­˜æ¨¡å‹å‚æ•°
def save_model_parameters(model, filepath):
    """ä¿å­˜æ¨¡å‹å‚æ•°åˆ°æ–‡ä»¶"""
    params = model.get_parameters()
    torch.save(params, filepath)
    print(f"æ¨¡å‹å‚æ•°å·²ä¿å­˜åˆ°: {filepath}")

# åŠ è½½æ¨¡å‹å‚æ•°
def load_model_parameters(model, filepath):
    """ä»æ–‡ä»¶åŠ è½½æ¨¡å‹å‚æ•°"""
    params = torch.load(filepath)
    model.set_parameters(params)
    print(f"æ¨¡å‹å‚æ•°å·²ä» {filepath} åŠ è½½")

# å‚æ•°ç»Ÿè®¡
def analyze_model_parameters(model):
    """åˆ†ææ¨¡å‹å‚æ•°ç»Ÿè®¡"""
    params = model.get_parameters()
    
    total_params = 0
    for name, param in params.items():
        param_count = param.numel()
        total_params += param_count
        print(f"{name}: {param.shape} ({param_count:,} å‚æ•°)")
    
    print(f"æ€»å‚æ•°æ•°é‡: {total_params:,}")
    return total_params

# ä½¿ç”¨ç¤ºä¾‹
model = CNNModel()
save_model_parameters(model, "model_checkpoint.pth")
param_count = analyze_model_parameters(model)</code></pre>
        </div>

        <div class="content-section">
            <h2>ğŸ”§ æ‰©å±•è‡ªå®šä¹‰æ¨¡å‹</h2>
            
            <h3>åˆ›å»ºè‡ªå®šä¹‰æ¨¡å‹ç±»</h3>
            <pre><code># models/resnet.py
import torch
import torch.nn as nn
import torchvision.models as models
from core.base import BaseModel

class ResNetModel(BaseModel):
    """ResNetæ¨¡å‹å®ç°"""
    
    def __init__(self, num_classes=10, pretrained=True, optimizer_config=None):
        super().__init__(optimizer_config)
        
        # ä½¿ç”¨é¢„è®­ç»ƒResNet-18
        self.model = models.resnet18(pretrained=pretrained)
        
        # ä¿®æ”¹æœ€åä¸€å±‚ä»¥é€‚åº”ç±»åˆ«æ•°
        self.model.fc = nn.Linear(self.model.fc.in_features, num_classes)
        
        # åˆ›å»ºæŸå¤±å‡½æ•°
        self.criterion = nn.CrossEntropyLoss()
        
        # åˆ›å»ºä¼˜åŒ–å™¨
        self.create_optimizer(self.model.parameters())
    
    def forward(self, x):
        return self.model(x)
    
    def get_parameters(self):
        """è·å–æ¨¡å‹å‚æ•°"""
        return {name: param.clone().detach() 
                for name, param in self.model.named_parameters()}
    
    def set_parameters(self, params):
        """è®¾ç½®æ¨¡å‹å‚æ•°"""
        with torch.no_grad():
            for name, param in self.model.named_parameters():
                if name in params:
                    param.copy_(params[name])
    
    def train_step(self, data, labels):
        """å•æ­¥è®­ç»ƒ"""
        self.model.train()
        
        # ç¡®ä¿æ•°æ®åœ¨æ­£ç¡®è®¾å¤‡ä¸Š
        data, labels = self._ensure_device_compatibility(data, labels)
        
        # å‰å‘ä¼ æ’­
        outputs = self.model(data)
        loss = self.criterion(outputs, labels)
        
        # åå‘ä¼ æ’­
        self.optimizer.zero_grad()
        loss.backward()
        self.optimizer.step()
        
        return loss.item()
    
    def evaluate(self, data, labels):
        """è¯„ä¼°æ¨¡å‹"""
        self.model.eval()
        
        with torch.no_grad():
            data, labels = self._ensure_device_compatibility(data, labels)
            
            outputs = self.model(data)
            loss = self.criterion(outputs, labels)
            
            # è®¡ç®—å‡†ç¡®ç‡
            _, predicted = torch.max(outputs.data, 1)
            accuracy = (predicted == labels).float().mean()
            
            return {
                'loss': loss.item(),
                'accuracy': accuracy.item()
            }</code></pre>

            <h3>æ³¨å†Œåˆ°æ¨¡å‹å·¥å‚</h3>
            <pre><code># utils/model_factory.py ä¸­æ·»åŠ 
from models.resnet import ResNetModel

class ModelFactory:
    @staticmethod
    def create_model(model_config, optimizer_config=None):
        model_type = model_config.get('type', 'cnn')
        
        if model_type == 'cnn':
            return CNNModel(optimizer_config)
        elif model_type == 'clip':
            return CLIPModel(optimizer_config)
        elif model_type == 'resnet':  # æ–°å¢
            num_classes = model_config.get('num_classes', 10)
            pretrained = model_config.get('pretrained', True)
            return ResNetModel(num_classes, pretrained, optimizer_config)
        else:
            raise ValueError(f"ä¸æ”¯æŒçš„æ¨¡å‹ç±»å‹: {model_type}")</code></pre>

            <h3>é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æ–°æ¨¡å‹</h3>
            <pre><code># configs/resnet_experiment.yaml
model:
  type: "resnet"
  num_classes: 10
  pretrained: true
  learning_rate: 0.001</code></pre>
        </div>

        <div class="content-section">
            <h2>âš¡ æ€§èƒ½ä¼˜åŒ–</h2>
            
            <h3>æ¨¡å‹ä¼˜åŒ–ç­–ç•¥</h3>
            <ul>
                <li><strong>æ··åˆç²¾åº¦è®­ç»ƒï¼š</strong> ä½¿ç”¨AMPå‡å°‘å†…å­˜ä½¿ç”¨å’Œæé«˜é€Ÿåº¦</li>
                <li><strong>æ¢¯åº¦ç´¯ç§¯ï¼š</strong> æ¨¡æ‹Ÿå¤§æ‰¹é‡è®­ç»ƒæ•ˆæœ</li>
                <li><strong>æ¨¡å‹å‰ªæï¼š</strong> å‡å°‘æ¨¡å‹å‚æ•°æ•°é‡</li>
                <li><strong>çŸ¥è¯†è’¸é¦ï¼š</strong> å¤§æ¨¡å‹å‘å°æ¨¡å‹ä¼ é€’çŸ¥è¯†</li>
            </ul>

            <h3>æ··åˆç²¾åº¦è®­ç»ƒç¤ºä¾‹</h3>
            <pre><code>from torch.cuda.amp import autocast, GradScaler

class OptimizedCNNModel(CNNModel):
    """æ”¯æŒæ··åˆç²¾åº¦çš„CNNæ¨¡å‹"""
    
    def __init__(self, optimizer_config=None, use_amp=True):
        super().__init__(optimizer_config)
        self.use_amp = use_amp and torch.cuda.is_available()
        self.scaler = GradScaler() if self.use_amp else None
    
    def train_step(self, data, labels):
        """æ”¯æŒæ··åˆç²¾åº¦çš„è®­ç»ƒæ­¥éª¤"""
        self.model.train()
        data, labels = self._ensure_device_compatibility(data, labels)
        
        self.optimizer.zero_grad()
        
        if self.use_amp:
            # æ··åˆç²¾åº¦è®­ç»ƒ
            with autocast():
                outputs = self.model(data)
                loss = self.criterion(outputs, labels)
            
            self.scaler.scale(loss).backward()
            self.scaler.step(self.optimizer)
            self.scaler.update()
        else:
            # å¸¸è§„è®­ç»ƒ
            outputs = self.model(data)
            loss = self.criterion(outputs, labels)
            loss.backward()
            self.optimizer.step()
        
        return loss.item()</code></pre>
        </div>

        <div class="content-section">
            <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>
            <div class="warning-box">
                <strong>è®¾å¤‡ä¸€è‡´æ€§ï¼š</strong> ç¡®ä¿æ¨¡å‹å’Œæ•°æ®åœ¨ç›¸åŒè®¾å¤‡ä¸Šï¼Œé¿å…è®¾å¤‡ä¸åŒ¹é…é”™è¯¯ã€‚
            </div>
            
            <div class="warning-box">
                <strong>å†…å­˜ç®¡ç†ï¼š</strong> å¤§æ¨¡å‹å¯èƒ½å¯¼è‡´æ˜¾å­˜ä¸è¶³ï¼Œåˆç†è®¾ç½®æ‰¹å¤§å°å’Œä½¿ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ã€‚
            </div>
            
            <div class="info-box">
                <strong>å‚æ•°åŒæ­¥ï¼š</strong> è”é‚¦å­¦ä¹ ä¸­ç¡®ä¿æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„æ¨¡å‹æ¶æ„å’Œå‚æ•°æ ¼å¼ã€‚
            </div>
            
            <div class="warning-box">
                <strong>é¢„è®­ç»ƒæ¨¡å‹ï¼š</strong> CLIPç­‰é¢„è®­ç»ƒæ¨¡å‹é¦–æ¬¡åŠ è½½éœ€è¦ä¸‹è½½æƒé‡æ–‡ä»¶ï¼Œç¡®ä¿ç½‘ç»œè¿æ¥ã€‚
            </div>
        </div>

        <div class="content-section">
            <h2>ğŸ“ˆ æ¨¡å‹è¯„ä¼°æŒ‡æ ‡</h2>
            <ul>
                <li><strong>å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰ï¼š</strong> åˆ†ç±»æ­£ç¡®çš„æ ·æœ¬æ¯”ä¾‹</li>
                <li><strong>æŸå¤±å€¼ï¼ˆLossï¼‰ï¼š</strong> æ¨¡å‹é¢„æµ‹ä¸çœŸå®æ ‡ç­¾çš„å·®è·</li>
                <li><strong>æ”¶æ•›é€Ÿåº¦ï¼š</strong> è¾¾åˆ°ç›®æ ‡æ€§èƒ½æ‰€éœ€çš„è®­ç»ƒè½®æ•°</li>
                <li><strong>é€šä¿¡æ•ˆç‡ï¼š</strong> è”é‚¦å­¦ä¹ ä¸­çš„å‚æ•°ä¼ è¾“å¼€é”€</li>
                <li><strong>é²æ£’æ€§ï¼š</strong> å¯¹æ•°æ®åˆ†å¸ƒå˜åŒ–çš„é€‚åº”èƒ½åŠ›</li>
            </ul>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 è”é‚¦å­¦ä¹ æ¡†æ¶. æ‰€æœ‰æƒåˆ©ä¿ç•™.</p>
            <p><a href="data.html">ä¸Šä¸€é¡µï¼šData æ¨¡å—</a> | <a href="utils.html">ä¸‹ä¸€é¡µï¼šUtils æ¨¡å—</a></p>
        </div>
    </footer>

    <script src="assets/script.js"></script>
</body>
</html>
